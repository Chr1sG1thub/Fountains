<html>
  <head>
  </head>
  <body>
    <table>
  <thead><tr><th>Lat</th></th><th>Lon</th><th>Name</th></tr></thead>
  <tbody id="table-body"></tbody>
</table>

<form id="entry-form">
  <h3>Add New Fountain Entry</h3>

  <label for="Lat">Lat:</label>
  
<input type="text" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" id="Lat" name="Lat" required>

  <label for="Lon">Lon:</label>
<input type="text" inputmode="decimal" pattern="[0-9]*[.,]?[0-9]*" id="Lon" name="Lon" required>

  <label for="Name">Name:</label>
  <input type="text" id="Name" name="Name" required>

  <button type="submit">Submit</button>
</form>

    <canvas id="linechart"></canvas>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
const form = document.getElementById('entry-form');
const tableBody = document.getElementById('table-body');
const ctx = document.getElementById('linechart').getContext('2d');
let chart; // Holds Chart.js instance

async function fetchDataAndUpdateUI() {
  const response = await fetch('https://sheetdb.io/api/v1/6mtneh34kqqbb');
  const data = await response.json();

  // Update table
  tableBody.innerHTML = '';
  data.forEach(row => {
    tableBody.innerHTML += `<tr><td>${row.Lat}</td><td>${row.Lon}</td><td>${row.Name}</td></tr>`;
  });

  // Prepare chart data
  const lats = data.map(row => row.Lat);
  const lons = data.map(row => row.Lon);

  if (chart) {
    chart.data.labels = lats;
    chart.data.datasets[0].data = lons;
    chart.update();
  } else {
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: lats,
        datasets: [{
          label: 'Lons',
          data: lons,
          borderColor: 'green',
          fill: false
        }]
      }
    });
  }
}

form.onsubmit = async (e) => {
  e.preventDefault();
  const Lat = form.Lat.value;
  const Lon = form.Lon.value;
  const Name = form.Name.value;

  await fetch('https://sheetdb.io/api/v1/6mtneh34kqqbb', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify([{ Lat, Lon, Name }])
  });

  form.reset();  // Clear form inputs
  fetchDataAndUpdateUI();  // Refresh table and chart
};

// Initial data load
fetchDataAndUpdateUI();
  </script>

  </body>
</html>
